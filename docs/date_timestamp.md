# 使用文档

## 运算符

### 基本算术运算符
- `+` : 加法运算，支持数字和字符串连接
- `-` : 减法运算
- `*` or `x` : 乘法运算（没有定义变量`x`时，`x`也可以作为乘号）
- `/` or `÷` : 除法运算（除数不能为0）
- `//` : 整除运算
- `%` : 取模运算
- `**` : 幂运算

### 一元运算符
- `-` : 一元负号
- `°` 或 `.rad` : 角度转弧度

### 位运算符
- `&` 或 `and` : 按位与
- `|` 或 `or` : 按位或
- `^` : 按位异或
- `~` 或 `not` : 按位取反
- `<<` : 左移
- `>>` : 右移
- `>>>` : 无符号右移

### 赋值运算符
- `=` : 基本赋值
- `+=` : 加法赋值
- `-=` : 减法赋值
- `*=` : 乘法赋值
- `/=` : 除法赋值
- `&=` : 按位与赋值
- `|=` : 按位或赋值
- `^=` : 按位异或赋值
- `<<=` : 左移赋值
- `>>=` : 右移赋值
- `>>>=` : 无符号右移赋值

## 常量
- `π`, `PI`, `pi` : 圆周率 (Math.PI)
- `e`, `E` : 自然对数的底 (Math.E)

## 进制

### 进制表示
- `0b` : 二进制数值前缀，如 `0b1010` 表示十进制的 10
- `0o` : 八进制数值前缀，如 `0o12` 表示十进制的 10
- `0x` : 十六进制数值前缀，如 `0xA` 表示十进制的 10

### 进制转换函数
- `bin(x)` : 十进制转二进制
- `oct(x)` : 十进制转八进制
- `hex(x)` : 十进制转十六进制

``` js
0b11        // 输出: 3
0o222       // 输出: 146
0x2E0       // 输出: 736

0b11 + 0o222 // 输出: 149
0b11 + 0x2E0 // 输出: 739

bin(3)     // 输出: 0b11
oct(146)   // 输出: 0o222
hex(736)   // 输出: 0x2E0

bin(3) + oct(146)           // 输出: 0b110o222, 将输出进行字符串连接了
num(bin(3)) + num(oct(146)) // 输出: 149, 显示转成数字进行计算
```


## 内置函数

### 数学函数
- `max(...args)` : 求最大值
- `min(...args)` : 求最小值
- `lg(x)` : 以10为底的对数
- `lb(x)` : 以2为底的对数
- `ln(x)` : 自然对数
- `log(x,y)` : 以x为底的y的对数
- `exp(x)` : e的指数
- `sqrt(x)` : 平方根
- `pow(x,y)` : 幂函数
- `abs(x)` : 绝对值

### 三角函数
- `sin(x)` : 正弦函数
- `cos(x)` : 余弦函数
- `tan(x)` : 正切函数
- `asin(x)` : 反正弦函数
- `acos(x)` : 反余弦函数
- `atan(x)` : 反正切函数

>[!tips] 三角函数默认使用弧度制

### 角度转换函数
- `deg(x)` : 弧度转换为度数， 比如 `deg(π)` 表示 π弧度对应的度数180°
- `rad(x)` : 度数转换为弧度， 比如 `rad(90)` 表示 90度对应的弧度


### 双曲函数
- `sinh(x)` : 双曲正弦
- `cosh(x)` : 双曲余弦
- `tanh(x)` : 双曲正切


## 字符串
- `str(x)` : 将输入的值转换为字符串
- `num(x)` : 将输入的值转换为数字
- `upper(x)` : 将字符串转换为大写, 支持属性调用, 也就是 "x.upper" 等价于 upper(x)
- `lower(x)` : 将字符串转换为小写, 支持属性调用 ".lower"
- `length(x)` : 获取字符串的长度, 支持属性调用 ".length"
- `base64(x)` : 对字符串进行Base64编码, 支持属性调用 ".base64"
- `unbase64(x)` : 对字符串进行Base64解码, 支持属性调用 ".unbase64"


``` js
// 三种字符串定义方式
"hello", 'hello', `hello`

// 使用str函数得到字符串，括号内的值都会被转成字符串
str("hello") // 得到字符串`"hello"`, 包括引号。

upper("hello")          // 输出: "HELLO"
lower("HELLO")          // 输出: "hello"
length("hello")         // 输出: 5
base64("hello")         // 输出: "aGVsbG8="
unbase64("aGVsbG8=")    // 输出: "hello"

// 这些函数都支持属性调用
"hello".upper           // 输出: "HELLO"
"HELLO".lower           // 输出: "hello"
"hello".length          // 输出: 5
"hello".base64          // 输出: "aGVsbG8="
"aGVsbG8=".unbase64     // 输出: "hello"

// 可以配合变量使用
a = "hello"
a.upper()   // 输出: "HELLO"

b = str("world")
b.upper()   // 输出: "WORLD"

a + b       // 输出: "helloworld"
```


## 时间计算

时间计算的运算符是`#`运算符，完整的用法是:

> `#(表达式)years(表达式)months(表达式)weeks(表达式)days(表达式)hours(表达式)minutes(表达式)seconds(表达式)milliseconds`

对于`时分秒`，还支持另一种写法:

> `#HH:mm:ss` 表示HH小时mm分钟ss秒
>
> `#HH:mm` 表示HH小时mm分钟


`#HH:mm:ss` 等价于 `#(h)hours(m)minutes(s)seconds`

`#HH:mm` 等价于 `#(h)hours(m)minutes`   


时间单位支持简写，完整的简写形式：

> `#(表达式)y(表达式)m(表达式)w(表达式)d(表达式)h(表达式)mm(表达式)s(表达式)ms`

其中:
| 单位 | 完整写法 | 简写 | 其他 |
| --- | --- | --- | --- |
| 年 | years | y | year |
| 月 | months | m | month |
| 周 | weeks | w | week |
| 天 | days | d | day |
| 小时 | hours | h | hour |
| 分钟 | minutes | mm | minute |
| 秒 | seconds | s | second |
| 毫秒 | milliseconds | ms | millisecond |


- 表达式是可以选的, 不用写完整
- 当括号内的表达式是数字时，括号可以省略。

比如 `#1d` 表示1天， `#-1h` 表示-1小时， `#1.5mm` 表示1.5分钟， `#1s` 表示1秒。

- **表达式不是数字时，括号不可以省略**

`#(1+2)d` 表示`1+2=3`天

`#(1-2)h` 表示`1-2=-1`小时， 

`#(1.5+2.5)mm` 表示`1.5+2.5=4`分钟， 

`#(1+2)s` 表示`1+2=3`秒。

`#(max(3, 2, 1))w` 表示`max(3, 2, 1)=3`周



```js

#1y2m3d     // 1年2月3天

#2w3d5h     // 2周3天5小时

#1d2h3mm    // 1天2小时3分钟

#1d2h3s     // 1天2小时3秒

#1d2h3ms    // 1天2小时3毫秒

#10:10:10    // 10小时10分钟10秒

#10:10       // 10小时10分钟

// 时间加法
#1y2m3d + #3w5h = #1y2m3w3d5h

// 时间减法
#1y2m3d - #3w5h = #1y2m3w3d5h


// 2小时10分钟10秒加上1小时20分钟20秒等于3小时30分钟30秒
#2:10:10 + #1:20:20 = #3:30:30  

// 10小时10分钟10秒减去10小时10分钟等于10秒
#10:10:10 - #10:10 = #0:0:10  

```

### 时间转换

> [!tips] 年和月不能转化为毫秒，因为它们是不可精确计算的。

- `#(时间)` : 默认格式：`xx年xx月` + `xx 毫秒`

使用 `> #` 转换为其他格式：
- `#(时间) > #` : 将时间转化为格式：`xx年xx月` + ` xx 天 xx 小时 xx 分钟 xx 秒 xx 毫秒`
- `#(时间) > #w` : 将时间转化为格式：`xx年xx月` + ` xx 周`
- `#(时间) > #d` : 将时间转化为格式：`xx年xx月` + ` xx 天`
- `#(时间) > #h` : 将时间转化为格式：`xx年xx月` + ` xx 小时`
- `#(时间) > #m` : 将时间转化为格式：`xx年xx月` + ` xx 分钟`
- `#(时间) > #s` : 将时间转化为格式：`xx年xx月` + ` xx 秒`
- `#(时间) > #ms` : 不支持，因为这是默认显示格式

``` js
#1d2h2mm             // 输出: 93780000ms
#1d2h2mm > #         // 输出: 1天 2小时 2分钟 0秒
#1d2h2mm > #w        // 输出: 0.15周
#1d2h2mm > #d        // 输出: 1.08天
#1d2h2mm > #h        // 输出: 26.03小时
#1d2h2mm > #m        // 输出: 1562.00分钟
#1d2h2mm > #s        // 输出: 93720.00秒


#1y1d2h2mm          // 输出: 1年+93780000ms
#1y1d2h2mm > #      // 输出: 1年+1天 2小时 2分钟 0秒
#1y2m1d2h2mm        // 输出: 1年2月+93780000ms
#1y2m1d2h2mm > #    // 输出: 1年2月+1天 2小时 2分钟 0秒
#1y2m1d2h2mm > #d   // 输出: 1年2月+1.08天
```



## 日期计算与时间戳

日期的运算符是`@`: 将日期字符串转时间戳，

支持多种日期格式：

- `@YYYY-MM-DD HH:mm:ss` : 完整日期时间
- `@YYYY-MM-DD HH:mm` : 日期和时分
- `@YYYY-MM-DD` : 仅日期
- `@MM-DD HH:mm:ss` : 月日时分秒（使用当前年份）
- `@MM-DD HH:mm` : 月日时分（使用当前年份）
- `@YYYY-MM` : 年月
- `@MM-DD` : 月日（使用当前年份）
- `@YYYY` : 仅年份


特别的支持：

- `@now` : 当前时间
- `@today` : 今天的零点时间



日期与时间的运算关系如下：

- `@日期` ： 得到时间戳
- `@日期 - @日期 = #时间` 
- `@日期 ± #时间 = @日期`
- `#时间 ± #时间 = #时间`
- `@日期 + @日期 --> ERROR ` 


`时间戳`是指距离 `1970-01-01 00:00:00` 的毫秒数， 其实也是一种特殊的`时间`

针对时间戳， 也有可视化操作将其转成日期字符串：
- `> @` : 格式化显示日期，将时间戳转日期字符串

``` js
// 日期 2019-01-10 五个月后的时间戳
@2019-01-10 + #5m
// 输出: 1560096000000

// 日期 2019-01-10 五个月后对于的日期
@2019-01-10 + #5m > @ 
// 输出: 2019-06-10

```


### 时间和日期的格式化输出

- `> @` : 格式化显示日期，将时间戳转日期字符串
- `> #` : 格式化显示时间差，转换为天时分秒格式



## 运算符优先级
运算符的优先级顺序，从低到高：

**优先级 `0`**：

赋值运算符：

`=, +=, -=, *=, /=, &=, |=, ^=, <<=, >>=, >>>=`

时间戳格式化运算符：

`>@, >#, >#w, >#d, >#h, >#m, >#s`

日期运算符：

`@+ @-`


**优先级 `1`**：

位运算和时间戳：

`|` (位或) `^` (位异或) `&` (位与) 

`@` (日期时间戳)



**优先级 `2`**：

加减： `+, -` 


**优先级 `3`**：

位移： `<<, >>, >>>` 


**优先级 `4`**：

乘除模整除： `*, /, %, //` 


**优先级 `5`**：

正负号
 
 `unary+`  (一元正号) 
 
 `unary-` (一元负号)


**优先级 `6`**：

前缀运算符： `~` (按位取反)


**优先级 `7`**：

幂运算： `**`


**优先级 `8`**：

属性函数后缀运算符： 

`.bin, .hex, .deg`



## 注意事项
1. 某些函数可以作为属性使用（如 .hex, .bin, .upper 等）
2. 三角函数的参数默认使用弧度制
3. Base64编码/解码仅支持字符串输入
4. 时间戳精确到毫秒
5. 日期计算默认使用北京时区